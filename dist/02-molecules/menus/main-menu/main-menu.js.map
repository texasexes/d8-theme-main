{"version":3,"sources":["02-molecules/menus/main-menu/main-menu.js"],"names":["remove","append","toggleClass","length","setTimeout","get","scrollIntoView","behavior","parseInt","outerHeight","each","clone","css","insertAfter","height","closest","ready","outerWidth","clearTimeout","document","window","addClass","click","preventDefault","children","next","resize","width","removeClass","scroll","scrollTop","jQuery","Drupal"],"mappings":"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","file":"main-menu.js","sourcesContent":["(function ($, Drupal) {\r\n\r\n  // WaitForFinalEvent Function\r\n  // This function allow us to only perform re-calculations AFTER an event has copmleted.\r\n  // Below, we'll use it to recalculate values only after the window has been resized, instead of recalculating every pixel change.\r\n  // Usage:\r\n  // $(window).resize(function () {\r\n  //   waitForFinalEvent(function(){\r\n  //     alert('Resize...');\r\n  //     //...\r\n  //   }, 500, \"some unique string\");\r\n  // });\r\n  const waitForFinalEvent = (function () {\r\n    const timers = {};\r\n    return function (callback, ms, uniqueId) {\r\n      if (!uniqueId) {\r\n        uniqueId = \"Don't call this twice without a uniqueId\";\r\n      }\r\n      if (timers[uniqueId]) {\r\n        clearTimeout (timers[uniqueId]);\r\n      }\r\n      timers[uniqueId] = setTimeout(callback, ms);\r\n    };\r\n  })();\r\n\r\n  // Element selectors\r\n  const dom = $(document);\r\n  const win = $(window);\r\n  const body = $('body');\r\n  const mainMenuToggle = $('.main-menu-toggle');\r\n  const mainMenuToggleOpen = $('.main-menu-toggle--open');\r\n  const mainMenu = $('.main-nav');\r\n  const mainMenuSub = $('.main-menu__dropdown');\r\n  const sideMenuSub = $('.side-menu__dropdown');\r\n  const sideMenuSubInner = $('.side-menu__dropdown-inner');\r\n  const mainMenuWithSub = $('.main-menu__item--with-sub');\r\n  const mainMenuExpandSub = $('.main-menu__expand-sub');\r\n  const sideMenuExpandSub = $('.side-menu__expand-sub');\r\n  const mainMenuSubIcon = $('.main-menu__sub-icon');\r\n  const sideMenuSubIcon = $('.side-menu__sub-icon');\r\n  const header = $('.header-wrapper');\r\n  const contentTopRegion = $('.content-top-region');\r\n  const layoutContainer = $('.layout-container');\r\n  const adminToolbar = $('#toolbar-bar');\r\n\r\n  // Calculated values\r\n  let winH = parseInt(win.outerHeight(), 10);\r\n  let winW = parseInt(win.outerWidth(), 10);\r\n  let headerHeight = 0;\r\n  let maxHeight = '100vh';\r\n  let mainMenuHeight = mainMenu.outerHeight();\r\n  // Needs .main-menu__item--active-trail-last in case menu item is in menu\r\n  // twice. Always scrolls to \"main\" menu item (the one designated on the entity).\r\n  let mainMenuActiveItem = $('#main-nav .main-menu__item--active-trail-last .is-active');\r\n  let dummyElement = $('');\r\n  let dummyElementMaxHeight = '0';\r\n  let currentScrollTop = 0;\r\n  let totalHeightToSkip = 0;\r\n  let adminToolbarHeight = parseInt(adminToolbar.outerHeight()) || 0;\r\n  let bodyFixedAdminBarHeight = 0;\r\n  let bodyFixedAdminBar = $('body.toolbar-fixed #toolbar-bar');\r\n  let bodyFixedAdminHorizontalTray = $('body.toolbar-fixed.toolbar-tray-open.toolbar-horizontal #toolbar-item-administration-tray');\r\n  let adminToolbarHorizontalTray = $('body.toolbar-tray-open.toolbar-horizontal #toolbar-item-administration-tray');\r\n\r\n  // Classes\r\n  const mainMenuSubOpen = 'main-menu__sub-icon--open';\r\n  const sideMenuSubOpen = 'side-menu__sub-icon--open';\r\n  const menuVisible = 'js-visible';\r\n  const mainMenuActive = 'js-menu-active';\r\n  const noscroll = 'noscroll';\r\n\r\n  // New elements\r\n  let mainMenuBg = '';\r\n\r\n  // Expand parent items if current page is the active menu item\r\n  $('.main-menu__item--active-trail > .main-menu__expand-sub > .main-menu__sub-icon').addClass(mainMenuSubOpen);\r\n  $('.main-menu__item--active-trail > .main-menu__dropdown').addClass(menuVisible);\r\n\r\n  $('.side-menu__item--active-trail > .side-menu__expand-sub > .side-menu__sub-icon').addClass(sideMenuSubOpen);\r\n  $('.side-menu__item--active-trail > .side-menu__dropdown').addClass(menuVisible);\r\n\r\n  // Remove mobile nav background\r\n  function removeMainMenuBg() {\r\n    mainMenuBg.remove();\r\n    mainMenuBg = '';\r\n  };\r\n\r\n  // Add mobile nav background\r\n  function addMainMenuBg() {\r\n    mainMenuBg = $('<span class=\"js-main-menu-close\" />');\r\n    mainMenuToggleOpen.append(mainMenuBg);\r\n  };\r\n\r\n  // Show/Hide overlay\r\n  function mainMenuBgToggle() {\r\n    // Prevent the background from scrolling when the mobile menu is active\r\n    body.toggleClass(noscroll);\r\n\r\n    // Display main menu\r\n    mainMenu.toggleClass(menuVisible);\r\n\r\n    //Scroll to main menu active item.\r\n    mainMenuActiveItem = $('#main-nav .main-menu__item--active-trail-last .is-active');\r\n    if (mainMenuActiveItem.length) {\r\n      // Wait for the menu to slide in, currently set at 0.5s in _main-menu.scss.\r\n      setTimeout(function() {\r\n        mainMenuActiveItem.get(0).scrollIntoView({\r\n          behavior: \"smooth\"\r\n        });\r\n      }, 500);\r\n    }\r\n\r\n    // Remove the overlay if it exists\r\n    if (mainMenuBg.length) {\r\n      removeMainMenuBg();\r\n    }\r\n    // Add overlay if needed\r\n    else {\r\n      addMainMenuBg();\r\n    }\r\n  };\r\n\r\n  // Main Menu\r\n  mainMenuToggle.click(function (e) {\r\n    e.preventDefault();\r\n    mainMenuBgToggle();\r\n  });\r\n\r\n  // Display Sub-nav\r\n  mainMenuExpandSub.click(function (e) {\r\n    e.preventDefault();\r\n    $(this).children(mainMenuSubIcon).toggleClass(mainMenuSubOpen);\r\n    $(this).next(mainMenuSub).toggleClass(menuVisible);\r\n  });\r\n\r\n  // Display Sub-nav\r\n  sideMenuExpandSub.click(function (e) {\r\n    e.preventDefault();\r\n    $(this).children(sideMenuSubIcon).toggleClass(sideMenuSubOpen);\r\n    $(this).next(sideMenuSub).toggleClass(menuVisible);\r\n  });\r\n\r\n  // Calculate body padding top (to accommodate the admin menu)\r\n  function calculateAdminToolbarHeight() {\r\n    adminToolbarHorizontalTray = $('body.toolbar-tray-open.toolbar-horizontal #toolbar-item-administration-tray');\r\n    adminToolbarHeight = (parseInt(adminToolbar.outerHeight()) || 0) + (parseInt(adminToolbarHorizontalTray.outerHeight()) || 0);\r\n  };\r\n\r\n  // Calculate body padding top (to accommodate the admin menu)\r\n  function calculateBodyFixedAdminBarHeight() {\r\n    bodyFixedAdminBar = $('body.toolbar-fixed #toolbar-bar');\r\n    bodyFixedAdminHorizontalTray = $('body.toolbar-fixed.toolbar-tray-open.toolbar-horizontal #toolbar-item-administration-tray');\r\n    bodyFixedAdminBarHeight = (parseInt(bodyFixedAdminBar.outerHeight()) || 0) + (parseInt(bodyFixedAdminHorizontalTray.outerHeight()) || 0);\r\n  };\r\n\r\n  // Calculate header height (to accommodate the fixed header bar)\r\n  function calculateHeaderHeight() {\r\n    headerHeight = parseInt(header.outerHeight()) || 0;\r\n  };\r\n\r\n  function setSideMenuSubMaxHeight() {\r\n    $(sideMenuSubInner).each(function () {\r\n      dummyElement = $(this).clone();\r\n      dummyElement.css({'visibility': 'hidden', 'position': 'absolute', 'max-height': 'unset' }).insertAfter(this);\r\n      dummyElementMaxHeight = dummyElement.height();\r\n      dummyElement.remove();\r\n      $(this).closest(sideMenuSub).css({'max-height': dummyElementMaxHeight});\r\n    });\r\n  }\r\n\r\n  // Set the height and position of the main-nav and header bar\r\n  function calculateMenuHeights() {\r\n    dom.ready(function() {\r\n      winH = parseInt(win.outerHeight(), 10);\r\n      winW = parseInt(win.outerWidth(), 10);\r\n      bodyFixedAdminBar = $('body.toolbar-fixed #toolbar-bar');\r\n\r\n      // calculateBodyPaddingTop();\r\n      calculateHeaderHeight();\r\n      calculateAdminToolbarHeight();\r\n      calculateBodyFixedAdminBarHeight();\r\n\r\n      maxHeight = winH - adminToolbarHeight;\r\n      mainMenu.css({'max-height': maxHeight});\r\n\r\n      if (winW <= 900) {\r\n        body.css({'padding-top': adminToolbarHeight + headerHeight});\r\n      } else {\r\n        body.css({'padding-top': adminToolbarHeight});\r\n      }\r\n\r\n      header.css({'top': adminToolbarHeight});\r\n\r\n      setSideMenuSubMaxHeight();\r\n    });\r\n  };\r\n\r\n  calculateMenuHeights();\r\n\r\n  // Update everything when the window is resized\r\n  win.resize(function () {\r\n    waitForFinalEvent(function(){\r\n      winW = parseInt(win.width(), 10);\r\n      // If desktop width remove all mobile menu stuff\r\n      if (winW > 900) {\r\n        // Remove background overlay\r\n        if (mainMenuBg.length) {\r\n          removeMainMenuBg();\r\n        }\r\n        // Class may remain if initial load is in mobile.\r\n        header.removeClass(\"scrollUp\");\r\n\r\n        // Margin may have been added.\r\n        header.css({'margin-top': ''});\r\n\r\n        // Remove noscroll class from body\r\n        body.removeClass(noscroll);\r\n        // Hide mobile menu\r\n        mainMenu.removeClass(menuVisible);\r\n      }\r\n\r\n      calculateMenuHeights();\r\n    }, 100, \"Main menu - window resize\");\r\n  });\r\n\r\n  var lastScrollTop = 0;\r\n  win.scroll(function () {\r\n    if (winW <= 900) {\r\n      currentScrollTop = parseInt(win.scrollTop());\r\n\r\n      // Scrolling down the page.\r\n      if (lastScrollTop < currentScrollTop) {\r\n\r\n        if (currentScrollTop > adminToolbarHeight + headerHeight) {\r\n          header.removeClass(\"show-menu-bar\");\r\n        }\r\n      } else {\r\n      // Scrolling up the page.\r\n        // Current scroll is past top menus.\r\n        if (currentScrollTop > (adminToolbarHeight - bodyFixedAdminBarHeight)) {\r\n          header.css({'top': -(headerHeight)});\r\n          header.css({'margin-top': bodyFixedAdminBarHeight});\r\n          header.removeClass(\"no-transition\");\r\n          header.addClass(\"scrollUp\");\r\n          header.addClass(\"show-menu-bar\");\r\n\r\n          // Current scroll is withing top menus.\r\n        } else  {\r\n          header.css({'top': adminToolbarHeight});\r\n          header.css({'margin-top': ''});\r\n          header.addClass(\"no-transition\");\r\n          header.removeClass(\"scrollUp\");\r\n          header.removeClass(\"show-menu-bar\");\r\n        }\r\n      }\r\n      lastScrollTop = currentScrollTop;\r\n    }\r\n  });\r\n\r\n}(jQuery, Drupal));\r\n"]}