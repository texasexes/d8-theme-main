{"version":3,"sources":["02-molecules/menus/main-menu/main-menu.js"],"names":["remove","append","toggleClass","length","setTimeout","get","scrollIntoView","behavior","parseInt","outerHeight","each","clone","css","insertAfter","height","closest","ready","outerWidth","clearTimeout","document","window","addClass","click","preventDefault","children","next","resize","width","removeClass","scroll","scrollTop","jQuery","Drupal"],"mappings":"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","file":"main-menu.js","sourcesContent":["(function ($, Drupal) {\n\n  // WaitForFinalEvent Function\n  // This function allow us to only perform re-calculations AFTER an event has copmleted.\n  // Below, we'll use it to recalculate values only after the window has been resized, instead of recalculating every pixel change.\n  // Usage:\n  // $(window).resize(function () {\n  //   waitForFinalEvent(function(){\n  //     alert('Resize...');\n  //     //...\n  //   }, 500, \"some unique string\");\n  // });\n  const waitForFinalEvent = (function () {\n    const timers = {};\n    return function (callback, ms, uniqueId) {\n      if (!uniqueId) {\n        uniqueId = \"Don't call this twice without a uniqueId\";\n      }\n      if (timers[uniqueId]) {\n        clearTimeout (timers[uniqueId]);\n      }\n      timers[uniqueId] = setTimeout(callback, ms);\n    };\n  })();\n\n  // Element selectors\n  const dom = $(document);\n  const win = $(window);\n  const body = $('body');\n  const mainMenuToggle = $('.main-menu-toggle');\n  const mainMenuToggleOpen = $('.main-menu-toggle--open');\n  const mainMenu = $('.main-nav');\n  const mainMenuSub = $('.main-menu__dropdown');\n  const sideMenuSub = $('.side-menu__dropdown');\n  const sideMenuSubInner = $('.side-menu__dropdown-inner');\n  const mainMenuWithSub = $('.main-menu__item--with-sub');\n  const mainMenuExpandSub = $('.main-menu__expand-sub');\n  const sideMenuExpandSub = $('.side-menu__expand-sub');\n  const mainMenuSubIcon = $('.main-menu__sub-icon');\n  const sideMenuSubIcon = $('.side-menu__sub-icon');\n  const header = $('.header-wrapper');\n  const contentTopRegion = $('.content-top-region');\n  const layoutContainer = $('.layout-container');\n  const adminToolbar = $('#toolbar-bar');\n\n  // Calculated values\n  let winH = parseInt(win.outerHeight(), 10);\n  let winW = parseInt(win.outerWidth(), 10);\n  let headerHeight = 0;\n  let maxHeight = '100vh';\n  let mainMenuHeight = mainMenu.outerHeight();\n  // Needs .main-menu__item--active-trail-last in case menu item is in menu\n  // twice. Always scrolls to \"main\" menu item (the one designated on the entity).\n  let mainMenuActiveItem = $('#main-nav .main-menu__item--active-trail-last .is-active');\n  let dummyElement = $('');\n  let dummyElementMaxHeight = '0';\n  let currentScrollTop = 0;\n  let totalHeightToSkip = 0;\n  let adminToolbarHeight = parseInt(adminToolbar.outerHeight()) || 0;\n  let bodyFixedAdminBarHeight = 0;\n  let bodyFixedAdminBar = $('body.toolbar-fixed #toolbar-bar');\n  let bodyFixedAdminHorizontalTray = $('body.toolbar-fixed.toolbar-tray-open.toolbar-horizontal #toolbar-item-administration-tray');\n  let adminToolbarHorizontalTray = $('body.toolbar-tray-open.toolbar-horizontal #toolbar-item-administration-tray');\n\n  // Classes\n  const mainMenuSubOpen = 'main-menu__sub-icon--open';\n  const sideMenuSubOpen = 'side-menu__sub-icon--open';\n  const menuVisible = 'js-visible';\n  const mainMenuActive = 'js-menu-active';\n  const noscroll = 'noscroll';\n\n  // New elements\n  let mainMenuBg = '';\n\n  // Expand parent items if current page is the active menu item\n  $('.main-menu__item--active-trail > .main-menu__expand-sub > .main-menu__sub-icon').addClass(mainMenuSubOpen);\n  $('.main-menu__item--active-trail > .main-menu__dropdown').addClass(menuVisible);\n\n  $('.side-menu__item--active-trail > .side-menu__expand-sub > .side-menu__sub-icon').addClass(sideMenuSubOpen);\n  $('.side-menu__item--active-trail > .side-menu__dropdown').addClass(menuVisible);\n\n  // Remove mobile nav background\n  function removeMainMenuBg() {\n    mainMenuBg.remove();\n    mainMenuBg = '';\n  };\n\n  // Add mobile nav background\n  function addMainMenuBg() {\n    mainMenuBg = $('<span class=\"js-main-menu-close\" />');\n    mainMenuToggleOpen.append(mainMenuBg);\n  };\n\n  // Show/Hide overlay\n  function mainMenuBgToggle() {\n    // Prevent the background from scrolling when the mobile menu is active\n    body.toggleClass(noscroll);\n\n    // Display main menu\n    mainMenu.toggleClass(menuVisible);\n\n    //Scroll to main menu active item.\n    mainMenuActiveItem = $('#main-nav .main-menu__item--active-trail-last .is-active');\n    if (mainMenuActiveItem.length) {\n      // Wait for the menu to slide in, currently set at 0.5s in _main-menu.scss.\n      setTimeout(function() {\n        mainMenuActiveItem.get(0).scrollIntoView({\n          behavior: \"smooth\"\n        });\n      }, 500);\n    }\n\n    // Remove the overlay if it exists\n    if (mainMenuBg.length) {\n      removeMainMenuBg();\n    }\n    // Add overlay if needed\n    else {\n      addMainMenuBg();\n    }\n  };\n\n  // Main Menu\n  mainMenuToggle.click(function (e) {\n    e.preventDefault();\n    mainMenuBgToggle();\n  });\n\n  // Display Sub-nav\n  mainMenuExpandSub.click(function (e) {\n    e.preventDefault();\n    $(this).children(mainMenuSubIcon).toggleClass(mainMenuSubOpen);\n    $(this).next(mainMenuSub).toggleClass(menuVisible);\n  });\n\n  // Display Sub-nav\n  sideMenuExpandSub.click(function (e) {\n    e.preventDefault();\n    $(this).children(sideMenuSubIcon).toggleClass(sideMenuSubOpen);\n    $(this).next(sideMenuSub).toggleClass(menuVisible);\n  });\n\n  // Calculate body padding top (to accommodate the admin menu)\n  function calculateAdminToolbarHeight() {\n    adminToolbarHorizontalTray = $('body.toolbar-tray-open.toolbar-horizontal #toolbar-item-administration-tray');\n    adminToolbarHeight = (parseInt(adminToolbar.outerHeight()) || 0) + (parseInt(adminToolbarHorizontalTray.outerHeight()) || 0);\n  };\n\n  // Calculate body padding top (to accommodate the admin menu)\n  function calculateBodyFixedAdminBarHeight() {\n    bodyFixedAdminBar = $('body.toolbar-fixed #toolbar-bar');\n    bodyFixedAdminHorizontalTray = $('body.toolbar-fixed.toolbar-tray-open.toolbar-horizontal #toolbar-item-administration-tray');\n    bodyFixedAdminBarHeight = (parseInt(bodyFixedAdminBar.outerHeight()) || 0) + (parseInt(bodyFixedAdminHorizontalTray.outerHeight()) || 0);\n  };\n\n  // Calculate header height (to accommodate the fixed header bar)\n  function calculateHeaderHeight() {\n    headerHeight = parseInt(header.outerHeight()) || 0;\n  };\n\n  function setSideMenuSubMaxHeight() {\n    $(sideMenuSubInner).each(function () {\n      dummyElement = $(this).clone();\n      dummyElement.css({'visibility': 'hidden', 'position': 'absolute', 'max-height': 'unset' }).insertAfter(this);\n      dummyElementMaxHeight = dummyElement.height();\n      dummyElement.remove();\n      $(this).closest(sideMenuSub).css({'max-height': dummyElementMaxHeight});\n    });\n  }\n\n  // Set the height and position of the main-nav and header bar\n  function calculateMenuHeights() {\n    dom.ready(function() {\n      winH = parseInt(win.outerHeight(), 10);\n      winW = parseInt(win.outerWidth(), 10);\n      bodyFixedAdminBar = $('body.toolbar-fixed #toolbar-bar');\n\n      // calculateBodyPaddingTop();\n      calculateHeaderHeight();\n      calculateAdminToolbarHeight();\n      calculateBodyFixedAdminBarHeight();\n\n      maxHeight = winH - adminToolbarHeight;\n      mainMenu.css({'max-height': maxHeight});\n\n      if (winW <= 900) {\n        body.css({'padding-top': adminToolbarHeight + headerHeight});\n      } else {\n        body.css({'padding-top': adminToolbarHeight});\n      }\n\n      header.css({'top': adminToolbarHeight});\n\n      setSideMenuSubMaxHeight();\n    });\n  };\n\n  calculateMenuHeights();\n\n  // Update everything when the window is resized\n  win.resize(function () {\n    waitForFinalEvent(function(){\n      winW = parseInt(win.width(), 10);\n      // If desktop width remove all mobile menu stuff\n      if (winW > 900) {\n        // Remove background overlay\n        if (mainMenuBg.length) {\n          removeMainMenuBg();\n        }\n        // Class may remain if initial load is in mobile.\n        header.removeClass(\"scrollUp\");\n\n        // Margin may have been added.\n        header.css({'margin-top': ''});\n\n        // Remove noscroll class from body\n        body.removeClass(noscroll);\n        // Hide mobile menu\n        mainMenu.removeClass(menuVisible);\n      }\n\n      calculateMenuHeights();\n    }, 100, \"Main menu - window resize\");\n  });\n\n  var lastScrollTop = 0;\n  win.scroll(function () {\n    if (winW <= 900) {\n      currentScrollTop = parseInt(win.scrollTop());\n\n      // Scrolling down the page.\n      if (lastScrollTop < currentScrollTop) {\n\n        if (currentScrollTop > adminToolbarHeight + headerHeight) {\n          header.removeClass(\"show-menu-bar\");\n        }\n      } else {\n      // Scrolling up the page.\n        // Current scroll is past top menus.\n        if (currentScrollTop > (adminToolbarHeight - bodyFixedAdminBarHeight)) {\n          header.css({'top': -(headerHeight)});\n          header.css({'margin-top': bodyFixedAdminBarHeight});\n          header.removeClass(\"no-transition\");\n          header.addClass(\"scrollUp\");\n          header.addClass(\"show-menu-bar\");\n\n          // Current scroll is withing top menus.\n        } else  {\n          header.css({'top': adminToolbarHeight});\n          header.css({'margin-top': ''});\n          header.addClass(\"no-transition\");\n          header.removeClass(\"scrollUp\");\n          header.removeClass(\"show-menu-bar\");\n        }\n      }\n      lastScrollTop = currentScrollTop;\n    }\n  });\n\n}(jQuery, Drupal));\n"]}